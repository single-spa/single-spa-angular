{"version":3,"file":"single-spa-angular-parcel.min.js","sources":["../lib/fesm2022/single-spa-angular-parcel.mjs"],"sourcesContent":["import * as i0 from '@angular/core';\nimport { input, effect, untracked, afterNextRender, inject, DestroyRef, Component, ChangeDetectionStrategy, NgModule } from '@angular/core';\n\nclass ParcelComponent {\n    constructor(host) {\n        this.host = host;\n        this.config = input(null);\n        this.mountParcel = input(null);\n        this.onParcelMount = input(null);\n        this.wrapWith = input('div');\n        this.customProps = input({});\n        this.appendTo = input(null);\n        this.handleError = input((error) => console.error(error));\n        this.hasError = false;\n        this.wrapper = null;\n        this.parcel = null;\n        this.task = null;\n        effect(() => {\n            const customProps = this.customProps();\n            untracked(() => {\n                this.scheduleTask(\"update\" /* Action.Update */, () => {\n                    this.parcel?.update?.(customProps);\n                });\n            });\n        });\n        afterNextRender(() => {\n            this.scheduleTask(\"mount\" /* Action.Mount */, () => {\n                if ((typeof ngDevMode === 'undefined' || ngDevMode) && this.mountParcel === null) {\n                    throw new Error('single-spa-angular: the [mountParcel] binding is required when using the <parcel> component. You can either (1) import mountRootParcel from single-spa or (2) use the mountParcel prop provided to single-spa applications.');\n                }\n                this.wrapper = document.createElement(this.wrapWith());\n                const appendTo = this.appendTo();\n                if (appendTo !== null) {\n                    appendTo.appendChild(this.wrapper);\n                }\n                else {\n                    this.host.nativeElement.appendChild(this.wrapper);\n                }\n                const mountParcel = this.mountParcel();\n                this.parcel = mountParcel(this.config(), {\n                    ...this.customProps(),\n                    domElement: this.wrapper,\n                });\n                const onParcelMount = this.onParcelMount();\n                if (onParcelMount !== null) {\n                    this.parcel.mountPromise.then(onParcelMount);\n                }\n                this.unmounted = false;\n                return this.parcel.mountPromise;\n            });\n        });\n        inject(DestroyRef).onDestroy(() => {\n            this.scheduleTask(\"unmount\" /* Action.Unmount */, () => {\n                if (this.parcel?.getStatus() === 'MOUNTED') {\n                    return this.parcel.unmount();\n                }\n            });\n            if (this.wrapper !== null) {\n                this.wrapper.parentNode.removeChild(this.wrapper);\n            }\n            this.unmounted = true;\n        });\n    }\n    scheduleTask(action, task) {\n        if (this.hasError && action !== \"unmount\" /* Action.Unmount */) {\n            // In an error state, we don't do anything anymore except for unmounting\n            return;\n        }\n        this.task = (this.task || Promise.resolve())\n            .then(() => {\n            if (this.unmounted && action !== \"unmount\" /* Action.Unmount */) {\n                // Never do anything once the angular component unmounts\n                return;\n            }\n            return task();\n        })\n            .catch((error) => {\n            this.task = Promise.resolve();\n            this.hasError = true;\n            if (error?.message) {\n                error.message = `During '${action}', parcel threw an error: ${error.message}`;\n            }\n            const handleError = this.handleError();\n            if (typeof handleError === 'function') {\n                handleError(error);\n            }\n            else {\n                setTimeout(() => {\n                    throw error;\n                });\n            }\n            // No more things to do should be done -- the parcel is in an error state\n            throw error;\n        });\n    }\n    /** @nocollapse */ static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: \"12.0.0\", version: \"19.2.9\", ngImport: i0, type: ParcelComponent, deps: [{ token: i0.ElementRef }], target: i0.ɵɵFactoryTarget.Component }); }\n    /** @nocollapse */ static { this.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: \"17.1.0\", version: \"19.2.9\", type: ParcelComponent, isStandalone: true, selector: \"parcel\", inputs: { config: { classPropertyName: \"config\", publicName: \"config\", isSignal: true, isRequired: false, transformFunction: null }, mountParcel: { classPropertyName: \"mountParcel\", publicName: \"mountParcel\", isSignal: true, isRequired: false, transformFunction: null }, onParcelMount: { classPropertyName: \"onParcelMount\", publicName: \"onParcelMount\", isSignal: true, isRequired: false, transformFunction: null }, wrapWith: { classPropertyName: \"wrapWith\", publicName: \"wrapWith\", isSignal: true, isRequired: false, transformFunction: null }, customProps: { classPropertyName: \"customProps\", publicName: \"customProps\", isSignal: true, isRequired: false, transformFunction: null }, appendTo: { classPropertyName: \"appendTo\", publicName: \"appendTo\", isSignal: true, isRequired: false, transformFunction: null }, handleError: { classPropertyName: \"handleError\", publicName: \"handleError\", isSignal: true, isRequired: false, transformFunction: null } }, ngImport: i0, template: '', isInline: true, changeDetection: i0.ChangeDetectionStrategy.OnPush }); }\n}\ni0.ɵɵngDeclareClassMetadata({ minVersion: \"12.0.0\", version: \"19.2.9\", ngImport: i0, type: ParcelComponent, decorators: [{\n            type: Component,\n            args: [{\n                    selector: 'parcel',\n                    template: '',\n                    changeDetection: ChangeDetectionStrategy.OnPush,\n                    standalone: true,\n                }]\n        }], ctorParameters: () => [{ type: i0.ElementRef }] });\n\nclass ParcelModule {\n    /** @nocollapse */ static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: \"12.0.0\", version: \"19.2.9\", ngImport: i0, type: ParcelModule, deps: [], target: i0.ɵɵFactoryTarget.NgModule }); }\n    /** @nocollapse */ static { this.ɵmod = i0.ɵɵngDeclareNgModule({ minVersion: \"14.0.0\", version: \"19.2.9\", ngImport: i0, type: ParcelModule, imports: [ParcelComponent], exports: [ParcelComponent] }); }\n    /** @nocollapse */ static { this.ɵinj = i0.ɵɵngDeclareInjector({ minVersion: \"12.0.0\", version: \"19.2.9\", ngImport: i0, type: ParcelModule }); }\n}\ni0.ɵɵngDeclareClassMetadata({ minVersion: \"12.0.0\", version: \"19.2.9\", ngImport: i0, type: ParcelModule, decorators: [{\n            type: NgModule,\n            args: [{\n                    imports: [ParcelComponent],\n                    exports: [ParcelComponent],\n                }]\n        }] });\n\n/**\n * Generated bundle index. Do not edit.\n */\n\nexport { ParcelComponent, ParcelModule };\n//# sourceMappingURL=single-spa-angular-parcel.mjs.map\n"],"names":["ParcelComponent","constructor","host","this","config","input","mountParcel","onParcelMount","wrapWith","customProps","appendTo","handleError","error","console","hasError","wrapper","parcel","task","effect","untracked","scheduleTask","update","afterNextRender","document","createElement","appendChild","nativeElement","domElement","mountPromise","then","unmounted","inject","DestroyRef","onDestroy","getStatus","unmount","parentNode","removeChild","action","Promise","resolve","catch","message","setTimeout","i0","ElementRef","ɵcmp","selectors","inputs","decls","vars","template","ParcelComponent_Template","rf","ctx","encapsulation","changeDetection"],"mappings":"kNA6BaA,EAeXC,WAAAA,CAAoBC,GAAAC,KAAID,KAAJA,EAdXC,KAAAC,OAASC,EAA2B,MACpCF,KAAAG,YAAcD,EAAsC,MACpDF,KAAAI,cAAgBF,EAA2B,MAC3CF,KAAAK,SAAWH,EAAM,OACjBF,KAAAM,YAAcJ,EAA+B,CAAA,GAC7CF,KAAAO,SAAWL,EAAmB,MAC9BF,KAAAQ,YAAcN,EAAOO,GAAiBC,QAAQD,MAAMA,IAErDT,KAAQW,UAAG,EAEXX,KAAOY,QAAuB,KAC9BZ,KAAMa,OAAkB,KACxBb,KAAIc,KAAyB,KAGnCC,EAAO,KACL,MAAMT,EAAcN,KAAKM,cACzBU,EAAU,KACRhB,KAAKiB,aAA4B,SAAK,KACpCjB,KAAKa,QAAQK,SAASZ,SAK5Ba,EAAgB,KACdnB,KAAKiB,aAA2B,QAAK,KAOnCjB,KAAKY,QAAUQ,SAASC,cAAcrB,KAAKK,YAE3C,MAAME,EAAWP,KAAKO,WACL,OAAbA,EACFA,EAASe,YAAYtB,KAAKY,SAE1BZ,KAAKD,KAAKwB,cAAcD,YAAYtB,KAAKY,SAG3C,MAAMT,EAAcH,KAAKG,cACzBH,KAAKa,OAASV,EAAaH,KAAKC,SAAW,IACtCD,KAAKM,cACRkB,WAAYxB,KAAKY,UAGnB,MAAMR,EAAgBJ,KAAKI,gBAM3B,OALsB,OAAlBA,GACFJ,KAAKa,OAAOY,aAAaC,KAAKtB,GAGhCJ,KAAK2B,WAAY,EACV3B,KAAKa,OAAOY,iBAIvBG,EAAOC,GAAYC,UAAU,KAC3B9B,KAAKiB,aAA6B,UAAK,KACrC,GAAiC,YAA7BjB,KAAKa,QAAQkB,YACf,OAAO/B,KAAKa,OAAOmB,YAIF,OAAjBhC,KAAKY,SACPZ,KAAKY,QAAQqB,WAAYC,YAAYlC,KAAKY,SAG5CZ,KAAK2B,WAAY,IAIbV,YAAAA,CAAakB,EAAgBrB,GAC/Bd,KAAKW,UAAuC,YAA3BwB,IAKrBnC,KAAKc,MAAQd,KAAKc,MAAQsB,QAAQC,WAC/BX,KAAK,KACJ,IAAI1B,KAAK2B,WAAwC,YAA3BQ,EAKtB,OAAOrB,MAERwB,MAAO7B,IACNT,KAAKc,KAAOsB,QAAQC,UACpBrC,KAAKW,UAAW,EAEZF,GAAO8B,UACT9B,EAAM8B,QAAU,WAAWJ,8BAAmC1B,EAAM8B,WAGtE,MAAM/B,EAAcR,KAAKQ,cAUzB,KAT2B,mBAAhBA,EACTA,EAAYC,GAEZ+B,WAAW,KACT,MAAM/B,IAKJA,kCA1GDZ,OAAAA,IAAAA,GAAAA,uBAAe4C,EAAAC,YAAA,CAAA,QAAf1C,KAAA2C,+BAAA9C,EAAe+C,UAAA,CAAA,CAAA,WAAAC,OAAA,CAAA5C,OAAA,CAAA,EAAA,UAAAE,YAAA,CAAA,EAAA,eAAAC,cAAA,CAAA,EAAA,iBAAAC,SAAA,CAAA,EAAA,YAAAC,YAAA,CAAA,EAAA,eAAAC,SAAA,CAAA,EAAA,YAAAC,YAAA,CAAA,EAAA,gBAAAsC,MAAA,EAAAC,KAAA,EAAAC,SAAAC,SAAAC,EAAAC,GAAA,EAAAC,cAAA,EAAAC,gBAAA,GAJd"}