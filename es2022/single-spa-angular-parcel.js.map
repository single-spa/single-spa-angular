{"version":3,"file":"single-spa-angular-parcel.js","sources":["../lib/fesm2022/single-spa-angular-parcel.mjs"],"sourcesContent":["import * as i0 from '@angular/core';\nimport { input, effect, untracked, afterNextRender, inject, DestroyRef, Component, ChangeDetectionStrategy, NgModule } from '@angular/core';\n\nclass ParcelComponent {\n    constructor(host) {\n        this.host = host;\n        this.config = input(null);\n        this.mountParcel = input(null);\n        this.onParcelMount = input(null);\n        this.wrapWith = input('div');\n        this.customProps = input({});\n        this.appendTo = input(null);\n        this.handleError = input((error) => console.error(error));\n        this.hasError = false;\n        this.wrapper = null;\n        this.parcel = null;\n        this.task = null;\n        effect(() => {\n            const customProps = this.customProps();\n            untracked(() => {\n                this.scheduleTask(\"update\" /* Action.Update */, () => {\n                    this.parcel?.update?.(customProps);\n                });\n            });\n        });\n        afterNextRender(() => {\n            this.scheduleTask(\"mount\" /* Action.Mount */, () => {\n                if ((typeof ngDevMode === 'undefined' || ngDevMode) && this.mountParcel === null) {\n                    throw new Error('single-spa-angular: the [mountParcel] binding is required when using the <parcel> component. You can either (1) import mountRootParcel from single-spa or (2) use the mountParcel prop provided to single-spa applications.');\n                }\n                this.wrapper = document.createElement(this.wrapWith());\n                const appendTo = this.appendTo();\n                if (appendTo !== null) {\n                    appendTo.appendChild(this.wrapper);\n                }\n                else {\n                    this.host.nativeElement.appendChild(this.wrapper);\n                }\n                const mountParcel = this.mountParcel();\n                this.parcel = mountParcel(this.config(), {\n                    ...this.customProps(),\n                    domElement: this.wrapper,\n                });\n                const onParcelMount = this.onParcelMount();\n                if (onParcelMount !== null) {\n                    this.parcel.mountPromise.then(onParcelMount);\n                }\n                this.unmounted = false;\n                return this.parcel.mountPromise;\n            });\n        });\n        inject(DestroyRef).onDestroy(() => {\n            this.scheduleTask(\"unmount\" /* Action.Unmount */, () => {\n                if (this.parcel?.getStatus() === 'MOUNTED') {\n                    return this.parcel.unmount();\n                }\n            });\n            if (this.wrapper !== null) {\n                this.wrapper.parentNode.removeChild(this.wrapper);\n            }\n            this.unmounted = true;\n        });\n    }\n    scheduleTask(action, task) {\n        if (this.hasError && action !== \"unmount\" /* Action.Unmount */) {\n            // In an error state, we don't do anything anymore except for unmounting\n            return;\n        }\n        this.task = (this.task || Promise.resolve())\n            .then(() => {\n            if (this.unmounted && action !== \"unmount\" /* Action.Unmount */) {\n                // Never do anything once the angular component unmounts\n                return;\n            }\n            return task();\n        })\n            .catch((error) => {\n            this.task = Promise.resolve();\n            this.hasError = true;\n            if (error?.message) {\n                error.message = `During '${action}', parcel threw an error: ${error.message}`;\n            }\n            const handleError = this.handleError();\n            if (typeof handleError === 'function') {\n                handleError(error);\n            }\n            else {\n                setTimeout(() => {\n                    throw error;\n                });\n            }\n            // No more things to do should be done -- the parcel is in an error state\n            throw error;\n        });\n    }\n    /** @nocollapse */ static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: \"12.0.0\", version: \"19.2.9\", ngImport: i0, type: ParcelComponent, deps: [{ token: i0.ElementRef }], target: i0.ɵɵFactoryTarget.Component }); }\n    /** @nocollapse */ static { this.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: \"17.1.0\", version: \"19.2.9\", type: ParcelComponent, isStandalone: true, selector: \"parcel\", inputs: { config: { classPropertyName: \"config\", publicName: \"config\", isSignal: true, isRequired: false, transformFunction: null }, mountParcel: { classPropertyName: \"mountParcel\", publicName: \"mountParcel\", isSignal: true, isRequired: false, transformFunction: null }, onParcelMount: { classPropertyName: \"onParcelMount\", publicName: \"onParcelMount\", isSignal: true, isRequired: false, transformFunction: null }, wrapWith: { classPropertyName: \"wrapWith\", publicName: \"wrapWith\", isSignal: true, isRequired: false, transformFunction: null }, customProps: { classPropertyName: \"customProps\", publicName: \"customProps\", isSignal: true, isRequired: false, transformFunction: null }, appendTo: { classPropertyName: \"appendTo\", publicName: \"appendTo\", isSignal: true, isRequired: false, transformFunction: null }, handleError: { classPropertyName: \"handleError\", publicName: \"handleError\", isSignal: true, isRequired: false, transformFunction: null } }, ngImport: i0, template: '', isInline: true, changeDetection: i0.ChangeDetectionStrategy.OnPush }); }\n}\ni0.ɵɵngDeclareClassMetadata({ minVersion: \"12.0.0\", version: \"19.2.9\", ngImport: i0, type: ParcelComponent, decorators: [{\n            type: Component,\n            args: [{\n                    selector: 'parcel',\n                    template: '',\n                    changeDetection: ChangeDetectionStrategy.OnPush,\n                    standalone: true,\n                }]\n        }], ctorParameters: () => [{ type: i0.ElementRef }] });\n\nclass ParcelModule {\n    /** @nocollapse */ static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: \"12.0.0\", version: \"19.2.9\", ngImport: i0, type: ParcelModule, deps: [], target: i0.ɵɵFactoryTarget.NgModule }); }\n    /** @nocollapse */ static { this.ɵmod = i0.ɵɵngDeclareNgModule({ minVersion: \"14.0.0\", version: \"19.2.9\", ngImport: i0, type: ParcelModule, imports: [ParcelComponent], exports: [ParcelComponent] }); }\n    /** @nocollapse */ static { this.ɵinj = i0.ɵɵngDeclareInjector({ minVersion: \"12.0.0\", version: \"19.2.9\", ngImport: i0, type: ParcelModule }); }\n}\ni0.ɵɵngDeclareClassMetadata({ minVersion: \"12.0.0\", version: \"19.2.9\", ngImport: i0, type: ParcelModule, decorators: [{\n            type: NgModule,\n            args: [{\n                    imports: [ParcelComponent],\n                    exports: [ParcelComponent],\n                }]\n        }] });\n\n/**\n * Generated bundle index. Do not edit.\n */\n\nexport { ParcelComponent, ParcelModule };\n//# sourceMappingURL=single-spa-angular-parcel.mjs.map\n"],"names":["ParcelComponent","constructor","host","config","input","mountParcel","onParcelMount","wrapWith","customProps","appendTo","handleError","error","console","hasError","wrapper","parcel","task","effect","untracked","scheduleTask","update","afterNextRender","ngDevMode","Error","document","createElement","appendChild","nativeElement","domElement","mountPromise","then","unmounted","inject","DestroyRef","onDestroy","getStatus","unmount","parentNode","removeChild","action","Promise","resolve","catch","message","setTimeout","i0","ElementRef","ɵcmp","selectors","inputs","decls","vars","template","ParcelComponent_Template","rf","ctx","encapsulation","changeDetection","Component","args","selector","ChangeDetectionStrategy","OnPush","standalone"],"mappings":"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"}